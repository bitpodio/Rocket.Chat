function module(e,t,n){let i,o,a,l,r,s,d,u,c,m,p,g,f,k,v,T,h,_,x,b,w,M,C;n.link("@babel/runtime/helpers/objectSpread2",{default(e){i=e}},0),n.link("react",{default(e){o=e},useEffect(e){a=e},useRef(e){l=e},useState(e){r=e},useCallback(e){s=e},useMemo(e){d=e}},0),n.link("meteor/templating",{Template(e){u=e}},1),n.link("meteor/blaze",{Blaze(e){c=e}},2),n.link("meteor/tracker",{Tracker(e){m=e}},3),n.link("@rocket.chat/fuselage-hooks",{useLocalStorage(e){p=e}},4),n.link("../../../models/client",{ChatMessage(e){g=e}},5),n.link("../../../../client/contexts/RouterContext",{useRoute(e){f=e}},6),n.link("../../../utils/client",{roomTypes(e){k=e}},7),n.link("../lib/normalizeThreadTitle",{normalizeThreadTitle(e){v=e}},8),n.link("../../../../client/contexts/UserContext",{useUserId(e){T=e},useUserSubscription(e){h=e}},9),n.link("../../../../client/contexts/ServerContext",{useEndpoint(e){_=e},useMethod(e){x=e}},10),n.link("../../../../client/contexts/ToastMessagesContext",{useToastMessageDispatch(e){b=e}},11),n.link("./ThreadSkeleton",{default(e){w=e}},12),n.link("./ThreadView",{default(e){M=e}},13),n.link("../../../../client/views/room/providers/ToolboxProvider",{useTabBarOpenUserInfo(e){C=e}},14);const y={},E=e=>{const[t,n]=r(()=>m.nonreactive(()=>g.findOne({_id:e}))),o=_("GET","chat.getMessage"),l=s(async e=>{const{message:t}=await o(e);return i(i({},t),{},{_updatedAt:new Date(t._updatedAt)})},[o]);return a(()=>{const t=m.autorun(async t=>{const i=g.findOne({_id:e})||await l({msgId:e});i&&!t.stopped&&n(e=>{var t,n;return e&&e._id===i._id&&(null===(t=e._updatedAt)||void 0===t?void 0:t.getTime())===(null===(n=i._updatedAt)||void 0===n?void 0:n.getTime())?e:i})});return()=>{t.stop()}},[l,e]),t},S=e=>{var t,n;let{mid:i,jump:m,room:g}=e;const _=h(g._id,y),S=f(k.getConfig(g.t).route.name),U=E(i),I=C(),j=l(null),z=T(),A=d(()=>U?v(U):null,[U]),[B,D]=p("expand-threads",!1),O=!!z&&(null!==(t=null==U?void 0:null===(n=U.replies)||void 0===n?void 0:n.includes(z))&&void 0!==t&&t),R=b(),F=x("followMessage"),G=x("unfollowMessage"),L=s(async e=>{try{if(e)return void(await F({mid:i}));await G({mid:i})}catch(t){R({type:"error",message:t})}},[R,F,G,i]),P=s(()=>{S.push("d"===g.t?{rid:g._id}:{name:g.name})},[S,g._id,g.t,g.name]),[V,W]=r(()=>({mainMessage:U,jump:m,following:O,subscription:_,rid:g._id,tabBar:{openUserInfo:I}}));return a(()=>{W(e=>{var t;return U&&(null===(t=e.mainMessage)||void 0===t?void 0:t._id)!==U._id?{mainMessage:U,jump:m,following:O,subscription:_,rid:g._id,tabBar:{openUserInfo:I}}:e})},[O,m,I,g._id,_,U]),a(()=>{if(!j.current||!V.mainMessage)return;const e=c.renderWithData(u.thread,V,j.current);return()=>{c.remove(e)}},[V]),U?o.createElement(M,{ref:j,title:A,expanded:B,following:O,onToggleExpand:e=>D(!e),onToggleFollow:e=>L(!e),onClose:P}):o.createElement(w,{expanded:B,onClose:P})};n.exportDefault(S)}

