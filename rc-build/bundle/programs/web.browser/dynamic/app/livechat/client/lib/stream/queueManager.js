function module(e,t,n){let a,i,r,d,u;n.link("@babel/runtime/helpers/objectSpread2",{default(e){a=e}},0),n.export({initializeLivechatInquiryStream:()=>f}),n.link("../../../../utils/client",{APIClient(e){i=e}},0),n.link("../../collections/LivechatInquiry",{LivechatInquiry(e){r=e}},1),n.link("./inquiry",{inquiryDataStream(e){d=e}},2),n.link("../../../../ui-utils/client",{call(e){u=e}},3);const c=new Set,l={added:e=>{delete e.type,c.has(e.department)&&r.insert(a(a({},e),{},{alert:!0,_updatedAt:new Date(e._updatedAt)}))},changed:e=>{if("queued"!==e.status||e.department&&!c.has(e.department))return r.remove(e._id);delete e.type,r.upsert({_id:e._id},a(a({},e),{},{alert:!0,_updatedAt:new Date(e._updatedAt)}))},removed:e=>r.remove(e._id)},s=e=>{l[e.type](e)},o=async()=>{const{inquiries:e}=await i.v1.get('livechat/inquiries.queued?sort={"ts": 1}');return e},p=e=>{d.removeListener("department/".concat(e),s),c.delete(e)},m=e=>(c.add(e),d.on("department/".concat(e),s),()=>p(e)),v=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=e.map(e=>m(e));return()=>t.forEach(e=>e())},h=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.forEach(e=>r.upsert({_id:e._id},a(a({},e),{},{_updatedAt:new Date(e._updatedAt)})))},y=async e=>{const{departments:t}=await i.v1.get("livechat/agents/".concat(e,"/departments?enabledDepartmentsOnly=true"));return t},g=()=>d.removeListener("public",s),_=()=>(d.on("public",s),g),w=async e=>{const t=await u("livechat:getRoutingConfig");if(t&&t.autoAssignAgent)return;const n=(await y(e)).map(e=>e.departmentId),a=n.length?await v(n):_();return h(await o()),()=>{r.remove({}),g(),a&&a(),c.clear()}},f=(()=>{let e;return async function(){e&&e(),e=await w(...arguments)}})()}

