function module(e,t,n){let l,a,r,i,o,s,c,u,m,d,p,h,v,f,b,E,_,k,x,g,w,y;function M(e){let{unitId:t,reload:n,allUnits:l}=e;const a=i(()=>({unitId:t}),[t]),{value:o,phase:s,error:c}=g("livechat/units.getOne",a),{value:u,phase:m,error:p}=g("livechat/department"),{value:h,phase:v,error:f}=g("livechat/monitors.list"),{value:b,phase:_,error:k}=g("livechat/unitMonitors.list",a),x=E();if([s,m,v,_].includes(w.LOADING))return r.createElement(y,null);if(c||p||f||k)return r.createElement(d,{m:"x16",type:"danger"},x("Not_Available"));const M={departments:u.departments.filter(e=>!(l&&l.units&&e.ancestors&&e.ancestors[0]!==t&&l.units.find(t=>t._id===e.ancestors[0])))};return(r.createElement(D,{unitId:t,data:o,availableDepartments:M,availableMonitors:h,unitMonitors:b,reload:n}))}function C(e){let{reload:t,allUnits:n}=e;const l=E(),{value:a,phase:i,error:o}=g("livechat/department"),{value:s,phase:c,error:m}=g("livechat/monitors.list");if([i,c].includes(w.LOADING))return r.createElement(y,null);if(o||m)return r.createElement(u,{mbs:"x16"},l("Not_found"));const d={departments:a.departments.filter(e=>!(n&&n.units&&e.ancestors&&n.units.find(t=>t._id===e.ancestors[0])))};return(r.createElement(D,{reload:t,isNew:!0,availableDepartments:d,availableMonitors:s}))}function D(e){let{data:t,unitId:n,isNew:d,availableDepartments:g,availableMonitors:w,unitMonitors:y,reload:M}=e,C=a(e,["data","unitId","isNew","availableDepartments","availableMonitors","unitMonitors","reload"]);const D=E(),S=x("omnichannel-units"),I=t||{},N=i(()=>g&&g.departments?g.departments.map(e=>{let{_id:t,name:n}=e;return[t,n||t]}):[],[g]),T=i(()=>w&&w.monitors?w.monitors.map(e=>{let{_id:t,name:n}=e;return[t,n||t]}):[],[w]),G=i(()=>y&&y.monitors?y.monitors.map(e=>{let{monitorId:t}=e;return t}):[],[y]),R=[["public",D("Public")],["private",D("Private")]],U=i(()=>g&&g.departments&&n?g.departments.map(e=>{let t;return e.parentId===n&&(t=e._id),t}).filter(e=>!!e):[],[g,n]),{values:L,handlers:q,hasUnsavedChanges:A}=k({name:I.name,visibility:I.visibility,departments:U,monitors:G}),{handleName:F,handleVisibility:P,handleDepartments:W,handleMonitors:B}=q,{name:O,visibility:V,departments:j,monitors:z}=L,H=i(()=>O&&0!==O.length?void 0:D("The_field_is_required",D("name")),[O,D]),J=i(()=>V&&0!==V.length?void 0:D("The_field_is_required",D("description")),[V,D]),K=i(()=>j&&0!==j.length?void 0:D("The_field_is_required",D("departments")),[j,D]),Q=i(()=>z&&0!==z.length?void 0:D("The_field_is_required",D("monitors")),[z,D]),X=f("livechat:saveUnit"),Y=b(),Z=v(()=>{M()}),$=i(()=>!(H||J||K||Q),[H,J,K,Q]),ee=v(async()=>{const e={name:O,visibility:V},t=j.map(e=>({departmentId:e})),l=z.map(e=>{const t=T.find(t=>t[0]===e);return{monitorId:t[0],username:t[1]}});if(!$)return Y({type:"error",message:D("The_field_is_required")});try{await X(n,e,l,t),Y({type:"success",message:D("Saved")}),M(),S.push({})}catch(a){Y({type:"error",message:a})}});return r.createElement(_.ScrollableContent,l({is:"form"},C),r.createElement(o,null,r.createElement(o.Label,null,D("Name"),"*"),r.createElement(o.Row,null,r.createElement(s,{placeholder:D("Name"),flexGrow:1,value:O,onChange:F,error:A&&H}))),r.createElement(o,null,r.createElement(o.Label,null,D("Visibility"),"*"),r.createElement(o.Row,null,r.createElement(p,{options:R,value:V,error:A&&J,placeholder:D("Select_an_option"),onChange:P,flexGrow:1}))),r.createElement(o,null,r.createElement(o.Label,null,D("Departments"),"*"),r.createElement(o.Row,null,r.createElement(m,{options:N,value:j,error:A&&K,maxWidth:"100%",placeholder:D("Select_an_option"),onChange:W,flexGrow:1}))),r.createElement(o,null,r.createElement(o.Label,null,D("Monitors"),"*"),r.createElement(o.Row,null,r.createElement(m,{options:T,value:z,error:A&&Q,maxWidth:"100%",placeholder:D("Select_an_option"),onChange:B,flexGrow:1}))),r.createElement(o.Row,null,r.createElement(u,{display:"flex",flexDirection:"row",justifyContent:"space-between",w:"full"},r.createElement(h,{inlineEnd:"x4"},!d&&r.createElement(c,{flexGrow:1,type:"reset",disabled:!A,onClick:Z},D("Reset")),r.createElement(c,{primary:!0,mie:"none",flexGrow:1,disabled:!A||!$,onClick:ee},D("Save"))))))}n.link("@babel/runtime/helpers/extends",{default(e){l=e}},0),n.link("@babel/runtime/helpers/objectWithoutProperties",{default(e){a=e}},1),n.export({UnitEditWithData:()=>M,UnitNew:()=>C,UnitEdit:()=>D}),n.link("react",{default(e){r=e},useMemo(e){i=e}},0),n.link("@rocket.chat/fuselage",{Field(e){o=e},TextInput(e){s=e},Button(e){c=e},Box(e){u=e},MultiSelect(e){m=e},Callout(e){d=e},Select(e){p=e},Margins(e){h=e}},1),n.link("@rocket.chat/fuselage-hooks",{useMutableCallback(e){v=e}},2),n.link("../../../../client/contexts/ServerContext",{useMethod(e){f=e}},3),n.link("../../../../client/contexts/ToastMessagesContext",{useToastMessageDispatch(e){b=e}},4),n.link("../../../../client/contexts/TranslationContext",{useTranslation(e){E=e}},5),n.link("../../../../client/components/VerticalBar",{default(e){_=e}},6),n.link("../../../../client/hooks/useForm",{useForm(e){k=e}},7),n.link("../../../../client/contexts/RouterContext",{useRoute(e){x=e}},8),n.link("../../../../client/hooks/useEndpointData",{useEndpointData(e){g=e}},9),n.link("../../../../client/hooks/useAsyncState",{AsyncStatePhase(e){w=e}},10),n.link("../../../../client/components/Skeleton",{FormSkeleton(e){y=e}},11)}

