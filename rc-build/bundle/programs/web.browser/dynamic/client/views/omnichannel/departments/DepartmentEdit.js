function module(e,t,n){let a,l,o,r,s,i,m,c,u,d,h,g,p,E,f,_,C,b,w,x,k,v,S,T,R,M,D,I,y,O,F,A,N,L,q,G,B,H,P;function Q(e){let{id:t,reload:n,title:a}=e;const o=T(),{value:r,phase:s,error:i}=G("livechat/department/".concat(t));return[s].includes(B.LOADING)?l.createElement(M,null):i?l.createElement(h,{mbs:"x16"},o("User_not_found")):l.createElement(W,{id:t,data:r,reload:n,title:a})}n.link("@babel/runtime/helpers/objectSpread2",{default(e){a=e}},0),n.export({default:()=>Q,EditDepartment:()=>W}),n.link("react",{default(e){l=e},useMemo(e){o=e},useState(e){r=e},useRef(e){s=e}},0),n.link("@rocket.chat/fuselage",{FieldGroup(e){i=e},Field(e){m=e},TextInput(e){c=e},Chip(e){u=e},SelectFiltered(e){d=e},Box(e){h=e},Icon(e){g=e},Divider(e){p=e},ToggleSwitch(e){E=e},TextAreaInput(e){f=e},ButtonGroup(e){_=e},Button(e){C=e}},1),n.link("@rocket.chat/fuselage-hooks",{useMutableCallback(e){b=e},useUniqueId(e){w=e}},2),n.link("use-subscription",{useSubscription(e){x=e}},3),n.link("../../../contexts/ServerContext",{useMethod(e){k=e}},4),n.link("../../../hooks/useEndpointAction",{useEndpointAction(e){v=e}},5),n.link("../../../contexts/ToastMessagesContext",{useToastMessageDispatch(e){S=e}},6),n.link("../../../contexts/TranslationContext",{useTranslation(e){T=e}},7),n.link("../../../contexts/SettingsContext",{useSetting(e){R=e}},8),n.link("../../../components/Skeleton",{FormSkeleton(e){M=e}},9),n.link("../../../hooks/useForm",{useForm(e){D=e}},10),n.link("../../../contexts/RouterContext",{useRoute(e){I=e},useRouteParameter(e){y=e},useCurrentRoute(e){O=e}},11),n.link("../../../components/Page",{default(e){F=e}},12),n.link("./DepartmentsAgentsTable",{default(e){A=e}},13),n.link("../additionalForms",{formsSubscription(e){N=e}},14),n.link("../../../hooks/useComponentDidUpdate",{useComponentDidUpdate(e){L=e}},15),n.link("../../../../app/utils",{isEmail(e){q=e}},16),n.link("../../../hooks/useEndpointData",{useEndpointData(e){G=e}},17),n.link("../../../hooks/useAsyncState",{AsyncStatePhase(e){B=e}},18),n.link("../../../../ee/client/hooks/useHasLicense",{useHasLicense(e){H=e}},19),n.link("../../../../ee/client/omnichannel/cannedResponses",{default(e){P=e}},20);const U=e=>{let{name:t}=e;return o(()=>({selector:JSON.stringify({name:t})}),[t])};function W(e){let{data:t,id:n,title:M,reload:B}=e;const Q=T(),W=I("omnichannel-departments"),j=x(N),V=s(t&&t.agents||[]),z=I("omnichannel-departments"),[,J]=O(),{useEeNumberInput:K=(()=>{}),useEeTextInput:X=(()=>{}),useEeTextAreaInput:Y=(()=>{}),useDepartmentForwarding:Z=(()=>{}),useDepartmentBusinessHours:$=(()=>{})}=j,ee=K(),te=K(),ne=Y(),ae=X(),le=Z(),oe=$(),[re,se]=r([]),{department:ie}=t||{department:{}},[me,ce]=r(ie&&ie.chatClosingTags||[]),[ue,de]=r(),{values:he,handlers:ge,hasUnsavedChanges:pe}=D({name:ie&&ie.name||"",email:ie&&ie.email||"",description:ie&&ie.description||"",enabled:!(!ie||!ie.enabled),maxNumberSimultaneousChat:ie&&ie.maxNumberSimultaneousChat||void 0,showOnRegistration:!(!ie||!ie.showOnRegistration),showOnOfflineForm:!(!ie||!ie.showOnOfflineForm),abandonedRoomsCloseCustomMessage:ie&&ie.abandonedRoomsCloseCustomMessage||"",requestTagBeforeClosingChat:ie&&ie.requestTagBeforeClosingChat||!1,offlineMessageChannelName:ie&&ie.offlineMessageChannelName||"",visitorInactivityTimeoutInSeconds:ie&&ie.visitorInactivityTimeoutInSeconds||void 0,waitingQueueMessage:ie&&ie.waitingQueueMessage||"",departmentsAllowedToForward:ie&&ie.departmentsAllowedToForward||[]}),{handleName:Ee,handleEmail:fe,handleDescription:_e,handleEnabled:Ce,handleMaxNumberSimultaneousChat:be,handleShowOnRegistration:we,handleShowOnOfflineForm:xe,handleAbandonedRoomsCloseCustomMessage:ke,handleRequestTagBeforeClosingChat:ve,handleOfflineMessageChannelName:Se,handleVisitorInactivityTimeoutInSeconds:Te,handleWaitingQueueMessage:Re,handleDepartmentsAllowedToForward:Me}=ge,{name:De,email:Ie,description:ye,enabled:Oe,maxNumberSimultaneousChat:Fe,showOnRegistration:Ae,showOnOfflineForm:Ne,abandonedRoomsCloseCustomMessage:Le,requestTagBeforeClosingChat:qe,offlineMessageChannelName:Ge,visitorInactivityTimeoutInSeconds:Be,waitingQueueMessage:He,departmentsAllowedToForward:Pe}=he,Qe=e=>()=>{ce(t=>t.filter(t=>t!==e))},Ue=b(()=>{me.includes(ue)||(ce([...me,ue]),de(""))}),We=b(e=>{de(e.target.value)}),je=U({offlineMessageChannelName:Ge}),{value:Ve={}}=G("rooms.autocomplete.channelAndPrivate",je),ze=o(()=>Ve&&Ve.items?Ve.items.map(e=>{let{name:t}=e;return[t,t]}):[],[Ve]),Je=k("livechat:saveDepartment"),Ke=v("POST","livechat/department/".concat(n,"/agents")),Xe=S(),[Ye,Ze]=r(),[$e,et]=r(),[tt,nt]=r();L(()=>{Ze(De?"":Q("The_field_is_required","name"))},[Q,De]),L(()=>{et(Ie?"":Q("The_field_is_required","email"))},[Q,Ie]),L(()=>{et(q(Ie)?"":Q("Validate_email_address"))},[Q,Ie]),L(()=>{nt(!qe||me&&0!==me.length?"":Q("The_field_is_required","name"))},[qe,Q,me]);const at=b(async e=>{e.preventDefault();let t=!1;if(De||(Ze(Q("The_field_is_required","name")),t=!0),Ie||(et(Q("The_field_is_required","email")),t=!0),q(Ie)||(et(Q("Validate_email_address")),t=!0),!qe||me&&0!==me.length||(nt(Q("The_field_is_required","tags")),t=!0),t)return;const a={enabled:Oe,name:De,description:ye,showOnRegistration:Ae,showOnOfflineForm:Ne,requestTagBeforeClosingChat:qe,email:Ie,chatClosingTags:me,offlineMessageChannelName:Ge,maxNumberSimultaneousChat:Fe,visitorInactivityTimeoutInSeconds:Be,abandonedRoomsCloseCustomMessage:Le,waitingQueueMessage:He,departmentsAllowedToForward:Pe&&Pe.join()},l={upsert:re.filter(e=>!V.current.some(t=>t._id===e._id&&e.count===t.count&&e.order===t.order)),remove:V.current.filter(e=>!re.some(t=>e._id===t._id))};try{n?(await Je(n,a,[]),await Ke(l)):await Je(n,a,re),Xe({type:"success",message:Q("Saved")}),B(),W.push({})}catch(t){Xe({type:"error",message:t})}}),lt=b(()=>{z.push({})}),ot=!De||!Ie||!q(Ie)||!pe||qe&&(!me||0===me.length),rt=w(),st=y("tab"),it=H("canned-responses"),mt=R("Canned_Responses_Enable"),ct=it&&mt&&"canned-responses"===st,ut=b(()=>{z.push(a(a({},J),{},{tab:"canned-responses"}))}),dt=b(()=>{z.push(a(a({},J),{},{tab:""}))}),ht=o(()=>t.agents.length===re.length,[t.agents,re]);return l.createElement(F,{flexDirection:"row"},l.createElement(F,null,l.createElement(F.Header,{title:M},l.createElement(_,null,n&&it&&mt&&l.createElement(C,{onClick:ut,title:Q("Canned Responses")},l.createElement(g,{name:"baloon-exclamation",size:"x16"})),l.createElement(C,{onClick:lt},l.createElement(g,{name:"back"})," ",Q("Back")),l.createElement(C,{type:"submit",form:rt,primary:!0,disabled:ot&&ht},Q("Save")))),l.createElement(F.ScrollableContentWithShadow,null,l.createElement(i,{w:"full",alignSelf:"center",maxWidth:"x600",id:rt,is:"form",autoComplete:"off",onSubmit:at},l.createElement(m,null,l.createElement(h,{display:"flex",flexDirection:"row"},l.createElement(m.Label,null,Q("Enabled")),l.createElement(m.Row,null,l.createElement(E,{flexGrow:1,checked:Oe,onChange:Ce})))),l.createElement(m,null,l.createElement(m.Label,null,Q("Name"),"*"),l.createElement(m.Row,null,l.createElement(c,{flexGrow:1,error:Ye,value:De,onChange:Ee,placeholder:Q("Name")}))),l.createElement(m,null,l.createElement(m.Label,null,Q("Description")),l.createElement(m.Row,null,l.createElement(f,{flexGrow:1,value:ye,onChange:_e,placeholder:Q("Description")}))),l.createElement(m,null,l.createElement(h,{display:"flex",flexDirection:"row"},l.createElement(m.Label,null,Q("Show_on_registration_page")),l.createElement(m.Row,null,l.createElement(E,{flexGrow:1,checked:Ae,onChange:we})))),l.createElement(m,null,l.createElement(m.Label,null,Q("Email"),"*"),l.createElement(m.Row,null,l.createElement(c,{flexGrow:1,error:$e,value:Ie,addon:l.createElement(g,{name:"mail",size:"x20"}),onChange:fe,placeholder:Q("Email")}))),l.createElement(m,null,l.createElement(h,{display:"flex",flexDirection:"row"},l.createElement(m.Label,null,Q("Show_on_offline_page")),l.createElement(m.Row,null,l.createElement(E,{flexGrow:1,checked:Ne,onChange:xe})))),l.createElement(m,null,l.createElement(m.Label,null,Q("Livechat_DepartmentOfflineMessageToChannel")),l.createElement(m.Row,null,l.createElement(d,{flexGrow:1,options:ze,value:Ge,onChange:Se,placeholder:Q("Channel_name")}))),ee&&l.createElement(m,null,l.createElement(ee,{value:Fe,handler:be,label:"Max_number_of_chats_per_agent",placeholder:"Max_number_of_chats_per_agent_description"})),te&&l.createElement(m,null,l.createElement(te,{value:Be,handler:Te,label:"How_long_to_wait_to_consider_visitor_abandonment_in_seconds",placeholder:"Number_in_seconds"})),ae&&l.createElement(m,null,l.createElement(ae,{value:Le,handler:ke,label:"Livechat_abandoned_rooms_closed_custom_message",placeholder:"Enter_a_custom_message"})),ne&&l.createElement(m,null,l.createElement(ne,{value:He,handler:Re,label:"Waiting_queue_message"})),le&&l.createElement(m,null,l.createElement(le,{departmentId:n,value:Pe,handler:Me,label:"List_of_departments_for_forward",placeholder:"Enter_a_department_name"})),l.createElement(m,null,l.createElement(h,{display:"flex",flexDirection:"row"},l.createElement(m.Label,null,Q("Request_tag_before_closing_chat")),l.createElement(m.Row,null,l.createElement(E,{flexGrow:1,checked:qe,onChange:ve})))),qe&&l.createElement(m,null,l.createElement(m.Label,{alignSelf:"stretch"},Q("Conversation_closing_tags"),"*"),l.createElement(m.Row,null,l.createElement(c,{error:tt,value:ue,onChange:We,placeholder:Q("Enter_a_tag")}),l.createElement(C,{mis:"x8",title:Q("add"),onClick:Ue},Q("Add"))),l.createElement(m.Hint,null,Q("Conversation_closing_tags_description")),me&&me.length>0&&l.createElement(m.Row,{justifyContent:"flex-start"},me.map((e,t)=>l.createElement(u,{key:t,onClick:Qe(e),mie:"x8"},e)))),oe&&l.createElement(m,null,l.createElement(oe,{bhId:ie&&ie.businessHourId})),l.createElement(p,{mb:"x16"}),l.createElement(m,null,l.createElement(m.Label,{mb:"x4"},Q("Agents"),":"),l.createElement(h,{display:"flex",flexDirection:"column",height:"50vh"},l.createElement(A,{agents:t&&t.agents,setAgentListFinal:se})))))),ct&&l.createElement(P,{departmentId:n,onClose:dt}))}}

