function module(e,t,n){let r,l,a,o,s,i,u,d,c,m,p,h,k,g,f,x,C,b,T,E,S,w,y,I,M,v,U,R,B,G,L,_,D,A,z,N,P,F,j,H,V,W;function O(e){return t=>{let{msg:n,username:o,replies:s=[],tcount:i,ts:u}=t,d=l(t,["msg","username","replies","tcount","ts"]);return(a.createElement(e,r({replies:i,participants:null==s?void 0:s.length,username:o,msg:n,ts:u},d)))}}n.link("@babel/runtime/helpers/extends",{default(e){r=e}},0),n.link("@babel/runtime/helpers/objectWithoutProperties",{default(e){l=e}},1),n.export({withData:()=>K,normalizeThreadMessage:()=>Y,ThreadList:()=>$}),n.link("react",{default(e){a=e},useCallback(e){o=e},useMemo(e){s=e},useState(e){i=e},useRef(e){u=e},memo(e){d=e}},0),n.link("react-virtuoso",{Virtuoso(e){c=e}},1),n.link("@rocket.chat/fuselage",{Box(e){m=e},Icon(e){p=e},TextInput(e){h=e},Select(e){k=e},Margins(e){g=e},Callout(e){f=e}},2),n.link("@rocket.chat/fuselage-hooks",{useDebouncedValue(e){x=e},useResizeObserver(e){C=e},useLocalStorage(e){b=e},useMutableCallback(e){T=e},useAutoFocus(e){E=e}},3),n.link("../../../../components/VerticalBar",{default(e){S=e}},4),n.link("../../../../contexts/TranslationContext",{useTranslation(e){w=e}},5),n.link("../../../../contexts/RouterContext",{useRoute(e){y=e},useCurrentRoute(e){I=e},useQueryStringParameter(e){M=e}},6),n.link("../../../../../app/ui-utils/client",{call(e){v=e}},7),n.link("../../../../contexts/UserContext",{useUserId(e){U=e},useUserSubscription(e){R=e}},8),n.link("../../hooks/useUserRoom",{useUserRoom(e){B=e}},9),n.link("../../../../contexts/SettingsContext",{useSetting(e){G=e}},10),n.link("../../../../hooks/useTimeAgo",{useTimeAgo(e){L=e}},11),n.link("../../../../lib/clickableItem",{clickableItem(e){_=e}},12),n.link("./components/Message",{default(e){D=e}},13),n.link("../../../../../lib/escapeHTML",{escapeHTML(e){A=e}},14),n.link("../../../../hooks/useAsyncState",{AsyncStatePhase(e){z=e}},15),n.link("../../providers/ToolboxProvider",{useTabBarClose(e){N=e},useTabContext(e){P=e}},16),n.link("../../../../../app/threads/client/components/ThreadComponent",{default(e){F=e}},17),n.link("../../../../lib/renderMessageBody",{renderMessageBody(e){j=e}},18),n.link("../../../../components/ScrollableContentWrapper",{default(e){H=e}},19),n.link("./useThreadsList",{useThreadsList(e){V=e}},20),n.link("../../../../hooks/lists/useRecordList",{useRecordList(e){W=e}},21);const Q=a.memo(O(_(D))),q={tunread:1,tunreadUser:1,tunreadGroup:1},J={t:1,name:1};function K(e){return t=>{let{rid:n}=t,u=l(t,["rid"]);const d=U(),c=N(),m=B(n,J),p=R(n,q),[h,k]=b("thread-list-type","all"),[g,f]=i(""),C=x(g,400),T=s(()=>({rid:n,text:C,type:h,tunread:null==p?void 0:p.tunread,uid:d}),[n,C,h,p,d]),{threadsList:E,initialItemCount:S,loadMoreItems:w}=V(T,d),{phase:y,error:I,items:M,itemCount:v}=W(E),G=o(e=>{f(e.currentTarget.value)},[]);return a.createElement(e,r({},u,{unread:null==p?void 0:p.tunread,unreadUser:null==p?void 0:p.tunreadUser,unreadGroup:null==p?void 0:p.tunreadGroup,userId:d,error:I,threads:M,total:v,initial:S,loading:y===z.LOADING,loadMoreItems:w,room:m,text:g,setText:G,type:h,setType:k,onClose:c}))}}const X=e=>{e.preventDefault(),e.stopPropagation(),v([!0,"true"].includes(e.currentTarget.dataset.following)?"unfollowMessage":"followMessage",{mid:e.currentTarget.dataset.id})},Y=e=>{let t=r({},e);if(t.msg)return j(t).replace(/<br\s?\\?>/g," ");if(t.attachments){const e=t.attachments.find(e=>e.title||e.description);if(e&&e.description)return A(e.description);if(e&&e.title)return A(e.title)}},Z=d((function e(t){let{thread:n,showRealNames:r,unread:l,unreadUser:o,unreadGroup:s,userId:i,onClick:u}=t;const d=w(),c=L(),m=Y(n),{name:p=n.u.username}=n.u;return a.createElement(Q,{tcount:n.tcount,tlm:n.tlm,ts:n.ts,u:n.u,replies:n.replies,name:r?p:n.u.username,username:n.u.username,unread:l.includes(n._id),mention:o.includes(n._id),all:s.includes(n._id),following:n.replies&&n.replies.includes(i),"data-id":n._id,msg:m,t:d,formatDate:c,handleFollowButton:X,onClick:u})}));function $(e){let{total:t=10,threads:n=[],room:r,unread:l=[],unreadUser:o=[],unreadGroup:i=[],type:d,setType:x,loadMoreItems:b,loading:v,onClose:U,error:R,userId:B,text:L,setText:_}=e;const D=G("UI_Use_Real_Name"),A=u(),z=w(),N=E(!0),[j]=I(),V=y(j),W=T(e=>{const{id:t}=e.currentTarget.dataset;V.push({tab:"thread",context:t,rid:r._id,name:r.name})}),O=s(()=>[["all",z("All")],["following",z("Following")],["unread",z("Unread")]],[z]);A.current=n;const{ref:Q,contentBoxSize:{inlineSize:q=378,blockSize:J=1}={}}=C({debounceDelay:200}),K=P(),X=M("jump");return a.createElement(a.Fragment,null,a.createElement(S.Header,null,a.createElement(S.Icon,{name:"thread"}),a.createElement(S.Text,null,z("Threads")),a.createElement(S.Close,{onClick:U})),a.createElement(S.Content,{paddingInline:0,ref:Q},a.createElement(m,{display:"flex",flexDirection:"row",p:"x24",borderBlockEndWidth:"x2",borderBlockEndStyle:"solid",borderBlockEndColor:"neutral-200",flexShrink:0},a.createElement(m,{display:"flex",flexDirection:"row",flexGrow:1,mi:"neg-x4"},a.createElement(g,{inline:"x4"},a.createElement(h,{placeholder:z("Search_Messages"),value:L,onChange:_,addon:a.createElement(p,{name:"magnifier",size:"x20"}),ref:N}),a.createElement(k,{flexGrow:0,width:"110px",onChange:x,value:d,options:O})))),a.createElement(m,{flexGrow:1,flexShrink:1,overflow:"hidden",display:"flex"},R&&a.createElement(f,{mi:"x24",type:"danger"},R.toString()),0===t&&a.createElement(m,{p:"x24"},z("No_Threads")),!R&&t>0&&n.length>0&&a.createElement(c,{style:{height:J,width:q},totalCount:t,endReached:v?()=>{}:e=>b(e,Math.min(50,t-e)),overscan:25,data:n,components:{Scroller:H},itemContent:(e,t)=>a.createElement(Z,{thread:t,showRealNames:D,unread:l,unreadUser:o,unreadGroup:i,userId:B,onClick:W})}))),K&&a.createElement(S.InnerContent,null,a.createElement(F,{mid:K,jump:X,room:r})))}n.exportDefault(K($))}

