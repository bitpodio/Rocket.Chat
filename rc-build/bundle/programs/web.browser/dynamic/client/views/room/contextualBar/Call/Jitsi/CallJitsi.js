function module(e,t,n){let o,i,l,s,a,r,c,u,m,d,_,f,E,C,k,x,p,T,w,J,R,S,h,U;n.export({CallJitsi:()=>g}),n.link("react",{default(e){o=e},useRef(e){i=e},useEffect(e){l=e},useState(e){s=e},useMemo(e){a=e},useLayoutEffect(e){r=e}},0),n.link("@rocket.chat/fuselage",{Box(e){c=e},Skeleton(e){u=e}},1),n.link("@rocket.chat/fuselage-hooks",{useMutableCallback(e){m=e},useSafely(e){d=e}},2),n.link("./components/CallModal",{CallModal(e){_=e}},3),n.link("../../../../../contexts/ModalContext",{useSetModal(e){f=e}},4),n.link("../../../../../contexts/UserContext",{useUserRoom(e){E=e},useUser(e){C=e}},5),n.link("../../../../../contexts/TranslationContext",{useTranslation(e){k=e}},6),n.link("../../../../../contexts/SettingsContext",{useSettings(e){x=e}},7),n.link("../../../../../components/VerticalBar",{default(e){p=e}},8),n.link("../../../../../../app/videobridge/constants",{HEARTBEAT(e){T=e},TIMEOUT(e){w=e},DEBOUNCE(e){J=e}},9),n.link("../../../../../contexts/ServerContext",{useMethod(e){R=e}},10),n.link("../../../../../contexts/ConnectionStatusContext",{useConnectionStatus(e){S=e}},11),n.link("./lib/JitsiBridge",{JitsiBridge(e){h=e}},12),n.link("../../../providers/ToolboxProvider",{useTabBarClose(e){U=e}},13);const g=e=>{let{handleClose:t,openNewWindow:n,refContent:i,children:l}=e;const s=k(),a=n?o.createElement(o.Fragment,null,o.createElement(c,{fontScale:"p2"},s("Video_Conference")),o.createElement(c,{fontScale:"p1",color:"neutral-700"},s("Opened_in_a_new_window"))):o.createElement("div",{ref:i});return o.createElement(o.Fragment,null,o.createElement(p.Header,null,o.createElement(p.Icon,{name:"phone"}),o.createElement(p.Text,null,s("Call")),t&&o.createElement(p.Close,{onClick:t})),o.createElement(p.ScrollableContent,null,a,l))},b={_id:["Jitsi_Open_New_Window","Jitsi_Domain","Jitsi_URL_Room_Hash","uniqueID","Jitsi_URL_Room_Prefix","Jitsi_URL_Room_Suffix","Jitsi_Chrome_Extension","Jitsi_SSL","Jitsi_Enabled_TokenAuth"]},D=e=>{let{rid:t}=e;const n=C(),{connected:c}=S(),[k,p]=d(s()),[D,A]=s(!1),B=E(t),L=f(),M=U(),j=m(()=>L(null)),v=R("jitsi:generateAccessToken"),N=R("jitsi:updateTimeout"),H=m(()=>{j(),M()}),I=i(),{Jitsi_Open_New_Window:O,Jitsi_Domain:W,Jitsi_SSL:y,Jitsi_Chrome_Extension:P,Jitsi_URL_Room_Hash:q,uniqueID:F,Jitsi_URL_Room_Prefix:V,Jitsi_URL_Room_Suffix:Y,Jitsi_Enabled_TokenAuth:z}=Object.fromEntries(x(b).map(e=>{let{_id:t,value:n}=e;return[t,n]}));l(()=>{let e=!1;if(z)return(async()=>{const n=await v(t);!e&&p(n)})(),()=>{e=!0};p()},[v,z,t,p]),r(()=>{c||M()},[c,M]);const G=q?F+t:encodeURIComponent("d"===B.t?B.usernames.join(" x "):B.name),K=a(()=>{if(z&&!k)return;const e=V+G+Y;return new h({openNewWindow:O,ssl:y,domain:W,jitsiRoomName:e,accessToken:k,desktopSharingChromeExtId:P,name:n.name||n.username},T)},[k,P,W,z,O,V,G,y,Y,n.name,n.username]),Q=m(()=>new Date-new Date(B.jitsiTimeout)>w?K.dispose():new Date-new Date(B.jitsiTimeout)+w>J?N(t):void 0);l(()=>{if(D&&K)return K.start(I.current),N(t),K.on("HEARTBEAT",Q),()=>{K.off("HEARTBEAT",Q),K.dispose()}},[D,K,t,Q,N]);const X=m(()=>{A(!0),O&&M()});return r(()=>{D?j():L(()=>o.createElement(_,{handleYes:X,handleCancel:H}))},[D,j,H,X,L]),o.createElement(g,{handleClose:M,openNewWindow:O,refContent:I},!D&&o.createElement(u,null))};n.exportDefault(o.memo(D))}

