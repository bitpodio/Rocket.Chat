function module(e,t,n){let l,a,r,s,o,i,c,d,u,m,h,f,p,E,T,g,_,D,x,w,k,C,P,b,v;n.link("@babel/runtime/helpers/objectWithoutProperties",{default(e){l=e}},0),n.export({DialogPruneMessages:()=>L,DateTimeRow:()=>M,PruneMessages:()=>N}),n.link("react",{default(e){a=e},useCallback(e){r=e},useEffect(e){s=e},useState(e){o=e}},0),n.link("@rocket.chat/fuselage",{Field(e){i=e},ButtonGroup(e){c=e},Button(e){d=e},CheckBox(e){u=e},InputBox(e){m=e},Box(e){h=e},Margins(e){f=e},Callout(e){p=e}},1),n.link("@rocket.chat/fuselage-hooks",{useMutableCallback(e){E=e},useUniqueId(e){T=e}},2),n.link("moment",{default(e){g=e}},3),n.link("../../../../../ee/client/audit/UserAutoCompleteMultiple",{default(e){_=e}},4),n.link("../../../../contexts/TranslationContext",{useTranslation(e){D=e}},5),n.link("../../../../components/VerticalBar",{default(e){x=e}},6),n.link("../../../../contexts/UserContext",{useUserRoom(e){w=e}},7),n.link("../../../../contexts/ToastMessagesContext",{useToastMessageDispatch(e){k=e}},8),n.link("../../../../contexts/ModalContext",{useSetModal(e){C=e}},9),n.link("../../../../hooks/useForm",{useForm(e){P=e}},10),n.link("../../../../contexts/ServerContext",{useMethod(e){b=e}},11),n.link("../../../../components/DeleteWarningModal",{default(e){v=e}},12);const y=function(){const e=(new Date).getTimezoneOffset(),t=Math.abs(e);return"".concat(e<0?"+":"-").concat("00".concat(Math.floor(t/60)).slice(-2),":").concat("00".concat(t%60).slice(-2))},L=e=>{let{children:t}=e,n=l(e,["children"]);return(a.createElement(v,n,a.createElement(h,{textAlign:"center",fontScale:"s1"},t)))},M=e=>{let{label:t,dateTime:n,handleDateTime:l}=e;return(a.createElement(i,null,a.createElement(i.Label,{flexGrow:0},t),a.createElement(h,{display:"flex",mi:"neg-x4"},a.createElement(f,{inline:"x4"},a.createElement(m,{type:"date",value:null==n?void 0:n.date,onChange:null==l?void 0:l.date,flexGrow:1,h:"x20"}),a.createElement(m,{type:"time",value:null==n?void 0:n.time,onChange:null==l?void 0:l.time,flexGrow:1,h:"x20"})))))},N=e=>{let{callOutText:t,validateText:n,newerDateTime:l,handleNewerDateTime:r,olderDateTime:s,handleOlderDateTime:o,users:m,inclusive:h,pinned:f,discussion:E,threads:g,attached:w,handleInclusive:k,handlePinned:C,handleDiscussion:P,handleThreads:b,handleAttached:v,onClickClose:y,onClickPrune:L,onChangeUsers:N}=e;const F=D(),O=T(),R=T(),I=T(),U=T(),B=T();return a.createElement(a.Fragment,null,a.createElement(x.Header,null,a.createElement(x.Icon,{name:"eraser"}),a.createElement(x.Text,null,F("Prune_Messages")),y&&a.createElement(x.Close,{onClick:y})),a.createElement(x.ScrollableContent,null,a.createElement(M,{label:F("Newer_than"),dateTime:l,handleDateTime:r}),a.createElement(M,{label:F("Older_than"),dateTime:s,handleDateTime:o}),a.createElement(i,null,a.createElement(i.Label,{flexGrow:0},F("Only_from_users")),a.createElement(_,{value:m,onChange:N,placeholder:F("Please_enter_usernames")})),a.createElement(i,null,a.createElement(i.Row,null,a.createElement(u,{id:O,checked:h,onChange:k}),a.createElement(i.Label,{htmlFor:O},F("Inclusive")))),a.createElement(i,null,a.createElement(i.Row,null,a.createElement(u,{id:R,checked:f,onChange:C}),a.createElement(i.Label,{htmlFor:R},F("RetentionPolicy_DoNotPrunePinned")))),a.createElement(i,null,a.createElement(i.Row,null,a.createElement(u,{id:I,checked:E,onChange:P}),a.createElement(i.Label,{htmlFor:I},F("RetentionPolicy_DoNotPruneDiscussion")))),a.createElement(i,null,a.createElement(i.Row,null,a.createElement(u,{id:U,checked:g,onChange:b}),a.createElement(i.Label,{htmlFor:U},F("RetentionPolicy_DoNotPruneThreads")))),a.createElement(i,null,a.createElement(i.Row,null,a.createElement(u,{id:B,checked:w,onChange:v}),a.createElement(i.Label,{htmlFor:B},F("Files_only")))),t&&!n&&a.createElement(p,{type:"warning"},t),n&&a.createElement(p,{type:"warning"},n)),a.createElement(x.Footer,null,a.createElement(c,{stretch:!0},a.createElement(d,{primary:!0,danger:!0,disabled:n&&!0,onClick:L},F("Prune")))))},F={newerDate:"",newerTime:"",olderDate:"",olderTime:"",users:[],inclusive:!1,pinned:!1,discussion:!1,threads:!1,attached:!1};n.exportDefault(e=>{let{rid:t,tabBar:n}=e;const l=D(),i=w(t);i.type=i.t,i.rid=t;const{name:c}=i,d=C(),u=E(()=>n&&n.close()),m=r(()=>d(null),[d]),h=k(),f=b("cleanRoomHistory"),[p,T]=o(new Date("0001-01-01T00:00:00Z")),[_,x]=o(new Date("9999-12-31T23:59:59Z")),[v,M]=o(),[O,R]=o(),[I,U]=o(0),{values:B,handlers:W,reset:A}=P(F),{newerDate:G,newerTime:S,olderDate:j,olderTime:H,users:Z,inclusive:q,pinned:z,discussion:V,threads:Y,attached:J}=B,{handleNewerDate:K,handleNewerTime:Q,handleOlderDate:X,handleOlderTime:$,handleUsers:ee,handleInclusive:te,handlePinned:ne,handleDiscussion:le,handleThreads:ae,handleAttached:re}=W,se=E((e,t)=>{if(!t){if(Z.includes(e))return;return ee([...Z,e])}ee(Z.filter(t=>t!==e))}),oe=E(async()=>{const e=2e3;let n;try{if(2e3===I)return;if(n=await f({roomId:t,latest:_,oldest:p,inclusive:q,limit:2e3,excludePinned:z,ignoreDiscussion:V,filesOnly:J,fromUsers:Z,ignoreThreads:Y}),U(n),n<1)throw new Error(l("No_messages_found_to_prune"));h({type:"success",message:"".concat(n," ").concat(l("messages_pruned"))}),m(),A()}catch(a){h({type:"error",message:a}),m()}}),ie=()=>{d(a.createElement(L,{onCancel:m,onDelete:oe,deleteText:l("Yes_prune_them")},l("Prune_Modal")))};return s(()=>{G&&T(new Date("".concat(G,"T").concat(S||"00:00",":00").concat(y()))),j&&x(new Date("".concat(j,"T").concat(H||"24:00",":00").concat(y())))},[G,S,j,H]),s(()=>{const e=z?" ".concat(l("except_pinned",{})):"",t=Z.length?" ".concat(l("if_they_are_from",{postProcess:"sprintf",sprintf:[Z.map(e=>e).join(", ")]})):"",n=l(J?"files":"messages",{});return M(G&&j?l("Prune_Warning_between",{postProcess:"sprintf",sprintf:[n,c,g(p).format("L LT"),g(_).format("L LT")]})+e+t:G?l("Prune_Warning_after",{postProcess:"sprintf",sprintf:[n,c,g(p).format("L LT")]})+e+t:j?l("Prune_Warning_before",{postProcess:"sprintf",sprintf:[n,c,g(_).format("L LT")]})+e+t:l("Prune_Warning_all",{postProcess:"sprintf",sprintf:[n,c]})+e+t),p>_?R(l("Newer_than_may_not_exceed_Older_than",{postProcess:"sprintf",sprintf:[]})):isNaN(p.getTime())||isNaN(_.getTime())?R(l("error-invalid-date",{postProcess:"sprintf",sprintf:[]})):void R()},[G,j,p,_,J,c,l,z,Z]),a.createElement(N,{callOutText:v,validateText:O,newerDateTime:{date:G,time:S},handleNewerDateTime:{date:K,time:Q},olderDateTime:{date:j,time:H},handleOlderDateTime:{date:X,time:$},users:Z,inclusive:q,pinned:z,discussion:V,threads:Y,attached:J,handleInclusive:te,handlePinned:ne,handleDiscussion:le,handleThreads:ae,handleAttached:re,onClickClose:u,onClickPrune:ie,onChangeUsers:se})})}

