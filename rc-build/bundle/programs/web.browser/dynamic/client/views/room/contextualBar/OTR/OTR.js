function module(e,t,n){let l,a,o,r,i,s,c,u,k,h,d,m,E,C,f,_;n.export({OTR:()=>b}),n.link("react",{default(e){l=e},useEffect(e){a=e},useMemo(e){o=e},useCallback(e){r=e}},0),n.link("@rocket.chat/fuselage-hooks",{useMutableCallback(e){i=e}},1),n.link("@rocket.chat/fuselage",{Box(e){s=e},Button(e){c=e},ButtonGroup(e){u=e},Throbber(e){k=e}},2),n.link("../../../../contexts/ModalContext",{useSetModal(e){h=e}},3),n.link("./OTRModal",{default(e){d=e}},4),n.link("../../../../../app/otr/client/rocketchat.otr",{OTR(e){m=e}},5),n.link("../../../../contexts/TranslationContext",{useTranslation(e){E=e}},6),n.link("../../../../components/VerticalBar",{default(e){C=e}},7),n.link("../../../../hooks/useReactiveValue",{useReactiveValue(e){f=e}},8),n.link("../../../../hooks/usePresence",{usePresence(e){_=e}},9);const b=e=>{let{isEstablishing:t,isEstablished:n,isOnline:a,onClickClose:o,onClickStart:r,onClickEnd:i,onClickRefresh:h}=e;const d=E();return(l.createElement(l.Fragment,null,l.createElement(C.Header,null,l.createElement(C.Icon,{name:"key"}),l.createElement(C.Text,null,d("OTR")),o&&l.createElement(C.Close,{onClick:o})),l.createElement(C.ScrollableContent,{p:"x24"},l.createElement(s,{fontScale:"s2"},d("Off_the_record_conversation")),!t&&!n&&a&&l.createElement(c,{onClick:r,primary:!0},d("Start_OTR")),t&&!n&&a&&l.createElement(l.Fragment,null," ",l.createElement(s,{fontScale:"p1"},d("Please_wait_while_OTR_is_being_established"))," ",l.createElement(k,{inheritColor:!0})," "),n&&a&&l.createElement(u,{stretch:!0},h&&l.createElement(c,{width:"50%",onClick:h},d("Refresh_keys")),i&&l.createElement(c,{width:"50%",danger:!0,onClick:i},d("End_OTR"))),!a&&l.createElement(s,{fontScale:"p2"},d("OTR_is_only_available_when_both_users_are_online")))))};n.exportDefault(e=>{let{rid:t,tabBar:n}=e;const s=i(()=>n&&n.close()),c=h(),u=i(()=>c()),k=o(()=>m.getInstanceByRoomId(t),[t]),[E,C]=f(r(()=>k?[k.established.get(),k.establishing.get()]:[!1,!1],[k])),R=_(k.peerId),T=!["offline","loading"].includes(R),g=()=>{k.handshake()},p=()=>null==k?void 0:k.end(),O=()=>{k.reset(),k.handshake(!0)};return a(()=>{if(E)return u();if(!C)return;const e=setTimeout(()=>{c(l.createElement(d,{onConfirm:u,onCancel:u}))},1e4);return()=>clearTimeout(e)},[u,E,C,c]),l.createElement(b,{isOnline:T,isEstablishing:C,isEstablished:E,onClickClose:s,onClickStart:g,onClickEnd:p,onClickRefresh:O})})}

