function module(e,t,n){let r,s,a,i,l,o,p,c,d;n.link("@babel/runtime/helpers/objectSpread2",{default(e){r=e}},0),n.link("react",{default(e){s=e},useEffect(e){a=e},useRef(e){i=e},useState(e){l=e}},0),n.link("../../../../app/apps/client/orchestrator",{Apps(e){o=e}},1),n.link("../../../../app/apps/client/communication",{AppEvents(e){p=e}},2),n.link("./helpers",{handleAPIError(e){c=e}},3),n.link("./AppsContext",{AppsContext(e){d=e}},4);const u=e=>{const t=Object.entries(e);for(const[r,s]of t){var n;null===(n=o.getWsListener())||void 0===n||n.registerListener(p[r],s)}return()=>{for(const[n,r]of t){var e;null===(e=o.getWsListener())||void 0===e||e.unregisterListener(p[n],r)}}},A=e=>{let{children:t}=e;const[n,p]=l(()=>[]),[A,f]=l(()=>!1),m=i(n);m.current=n;const v=()=>{p(e=>[...e])},h=()=>m.current.slice(0);a(()=>{const e=e=>{p(e.sort((e,t)=>e.name.toLowerCase()>t.name.toLowerCase()?1:-1)),v()},t=async e=>{try{const{status:t,version:n}=await o.getApp(e),s=await o.getAppFromMarketplace(e,n),a=h(),i=a.findIndex(t=>{let{id:n}=t;return n===e});a[i]=r(r({},s),{},{installed:!0,status:t,version:n,marketplaceVersion:s.version}),p(a),v()}catch(t){c(t)}},n={APP_ADDED:t,APP_UPDATED:t,APP_REMOVED:e=>{const t=h(),n=t.findIndex(t=>{let{id:n}=t;return n===e});t[n]&&(!1!==t[n].marketplace?t.splice(n,1):(delete t[n].installed,delete t[n].status,t[n].version=t[n].marketplaceVersion),p(t),v())},APP_STATUS_CHANGE:e=>{let{appId:t,status:n}=e;const r=h(),s=r.find(e=>{let{id:n}=e;return n===t});s&&(s.status=n,p(r),v())},APP_SETTING_UPDATED:()=>{v()}},s=u(n),a=async()=>{try{const t=await o.getApps().then(t=>{let n=[];return t.length&&(n=t.map(e=>r(r({},e),{},{installed:!0,marketplace:!1})),e(n)),n}),n=await o.getAppsFromMarketplace(),s=n.length?n.map(e=>{const n=t.findIndex(t=>{let{id:n}=t;return n===e.id});if(!t[n])return r(r({},e),{},{status:void 0,marketplaceVersion:e.version,bundledIn:e.bundledIn});const s=t.splice(n,1).pop();return r(r(r({},e),{},{installed:!0},s&&{status:s.status,version:s.version}),{},{bundledIn:e.bundledIn,marketplaceVersion:e.version})}):[];t.length&&s.push(...t),e(s),f(!0)}catch(t){c(t),s()}};return a(),s},[]);const k={apps:n,finishedLoading:A};return(s.createElement(d.Provider,{children:t,value:k}))};n.exportDefault(A)}

