function module(e,t,n){let i,o,a,r,l,c,d,u,s,m,p,b,f,v,k,I,g,x,y,E,h,C,w,S;n.link("@babel/runtime/helpers/objectSpread2",{default(e){i=e}},0),n.link("@babel/runtime/helpers/objectWithoutProperties",{default(e){o=e}},1),n.export({ModalBlock:()=>U}),n.link("@rocket.chat/apps-engine/definition/uikit/UIKitIncomingInteractionContainer",{UIKitIncomingInteractionContainerType(e){a=e}},0),n.link("@rocket.chat/fuselage",{Modal(e){r=e},AnimatedVisibility(e){l=e},ButtonGroup(e){c=e},Button(e){d=e},Box(e){u=e}},1),n.link("@rocket.chat/fuselage-hooks",{useMutableCallback(e){s=e},useUniqueId(e){m=e}},2),n.link("@rocket.chat/fuselage-ui-kit",{kitContext(e){p=e},UiKitComponent(e){b=e},UiKitModal(e){f=e},modalParser(e){v=e}},3),n.link("react",{default(e){k=e},useCallback(e){I=e},useEffect(e){g=e},useMemo(e){x=e},useReducer(e){y=e},useRef(e){E=e},useState(e){h=e}},4),n.link("../../lib/renderMessageBody",{renderMessageBody(e){C=e}},5),n.link("../../../app/utils/lib/getURL",{getURL(e){w=e}},6),n.link("../../../app/ui-message/client/ActionManager",{"*"(e){S=e}},7),v.plainText=function(){let{text:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e},v.mrkdwn=e=>{let{text:t}=e;return(k.createElement("span",{dangerouslySetInnerHTML:{__html:C({msg:t})}}))};const M='\n\ta[href]:not([tabindex="-1"]),\n\tarea[href]:not([tabindex="-1"]),\n\tinput:not([disabled]):not([tabindex="-1"]),\n\tselect:not([disabled]):not([tabindex="-1"]),\n\ttextarea:not([disabled]):not([tabindex="-1"]),\n\tbutton:not([disabled]):not([tabindex="-1"]),\n\tiframe,\n\tobject,\n\tembed,\n\t[tabindex]:not([tabindex="-1"]),\n\t[contenteditable]',P='\n\ta[href]:not([tabindex="-1"]):invalid,\n\tarea[href]:not([tabindex="-1"]):invalid,\n\tinput:not([disabled]):not([tabindex="-1"]):invalid,\n\tselect:not([disabled]):not([tabindex="-1"]):invalid,\n\ttextarea:not([disabled]):not([tabindex="-1"]):invalid,\n\tbutton:not([disabled]):not([tabindex="-1"]):invalid,\n\tiframe:invalid,\n\tobject:invalid,\n\tembed:invalid,\n\t[tabindex]:not([tabindex="-1"]):invalid,\n\t[contenteditable]:invalid';function U(e){let{view:t,errors:n,appId:i,onSubmit:o,onClose:a,onCancel:s}=e;const p="modal_id_".concat(m()),y=E();g(()=>{if(y.current)if(n&&Object.keys(n).length){const e=y.current.querySelector(P);e&&e.focus()}else{const e=y.current.querySelector(M);e&&e.focus()}},[n]);const h=x(()=>document.activeElement,[]);g(()=>()=>h&&h.focus(),[h]);const C=I(e=>{if(13===e.keyCode)return o(e);if(27===e.keyCode)return e.stopPropagation(),e.preventDefault(),a(),!1;if(9===e.keyCode){const t=Array.from(y.current.querySelectorAll(M)),[n]=t,i=t.pop();if(!y.current.contains(document.activeElement))return n.focus();if(e.shiftKey)return void(n&&n!==document.activeElement||(i.focus(),e.stopPropagation(),e.preventDefault()));i&&i!==document.activeElement||(n.focus(),e.stopPropagation(),e.preventDefault())}},[a,o]);return g(()=>{const e=document.querySelector(".rc-modal-wrapper"),t=e.querySelector(".rcx-modal__content"),n=t=>{if(t.target===e)return t.preventDefault(),t.stopPropagation(),a(),!1},i=e=>{if(t.contains(e.target))return C(e)};return document.addEventListener("keydown",i),e.addEventListener("click",n),()=>{document.removeEventListener("keydown",i),e.removeEventListener("click",n)}},[C,a]),k.createElement(l,{visibility:l.UNHIDING},k.createElement(r,{open:!0,id:p,ref:y},k.createElement(r.Header,null,t.showIcon?k.createElement(r.Thumb,{url:w("/api/apps/".concat(i,"/icon"))}):null,k.createElement(r.Title,null,v.text(t.title)),k.createElement(r.Close,{tabIndex:-1,onClick:a})),k.createElement(r.Content,null,k.createElement(u,{is:"form",method:"post",action:"#",onSubmit:o},k.createElement(b,{render:f,blocks:t.blocks}))),k.createElement(r.Footer,null,k.createElement(c,{align:"end"},t.close&&k.createElement(d,{onClick:s},v.text(t.close.text)),t.submit&&k.createElement(d,{primary:!0,onClick:o},v.text(t.submit.text))))))}const j=e=>{const[t,n]=h(e),{viewId:a}=t;return g(()=>{const e=e=>{let{type:t}=e,a=o(e,["type"]);if("errors"!==t)n(a);else{const{errors:e}=a;n(t=>i(i({},t),{},{errors:e}))}};return S.on(a,e),()=>{S.off(a,e)}},[a]),t},A=e=>{const t=s((e,t)=>{let{actionId:n,payload:o}=t;return i(i({},e),{},{[n]:o})}),n=s(()=>{const t=e=>{let{element:n,elements:i=[]}=e;return!(!n||!n.initialValue)||(!(!i.length||!i.map(e=>({element:e})).filter(t).length)||void 0)},n=e=>{let{element:i,blockId:o,elements:a=[]}=e;return a.length?a.map(e=>({element:e,blockId:o})).filter(t).map(n):[i.actionId,{value:i.initialValue,blockId:o}]};return e.blocks.filter(t).map(n).reduce((e,t)=>{if(Array.isArray(t[0]))return i(i({},e),Object.fromEntries(t));const[n,o]=t;return i(i({},e),{},{[n]:o})},{})});return y(t,null,n)};function B(e){const t=j(e),{appId:n,viewId:o,mid:r,errors:l,view:c}=t,[d,u]=A(c),m=e=>Object.entries(e).reduce((e,t)=>{let[n,{blockId:i,value:o}]=t;return e[i]=e[i]||{},e[i][n]=o,e},{}),b=e=>{e&&((e.nativeEvent||e).stopImmediatePropagation(),e.stopPropagation(),e.preventDefault())},f=i(i({action:e=>{let{actionId:t,appId:n,value:i,blockId:l,mid:c=r}=e;return S.triggerBlockAction({container:{type:a.VIEW,id:o},actionId:t,appId:n,value:i,blockId:l,mid:c})},state:e=>{let{actionId:t,value:n,blockId:i="default"}=e;u({actionId:t,payload:{blockId:i,value:n}})}},t),{},{values:d}),v=s(e=>{b(e),S.triggerSubmitView({viewId:o,appId:n,payload:{view:i(i({},c),{},{id:o,state:m(d)})}})}),I=s(e=>(b(e),S.triggerCancel({appId:n,viewId:o,view:i(i({},c),{},{id:o,state:m(d)})}))),g=s(e=>(b(e),S.triggerCancel({appId:n,viewId:o,view:i(i({},c),{},{id:o,state:m(d)}),isCleared:!0})));return k.createElement(p.Provider,{value:f},k.createElement(U,{view:c,errors:l,appId:n,onSubmit:v,onCancel:I,onClose:g}))}n.exportDefault(B)}

