function module(e,r,n){let t,o,s,i,c,u,a;n.export({compileDocumentSelector:()=>K}),n.link("./comparisons",{equals(e){t=e},flatSome(e){o=e},isObject(e){s=e},some(e){i=e}},0),n.link("./lookups",{createLookupFunction(e){c=e}},1),n.link("./bson",{compareBSONValues(e){u=e},getBSONType(e){a=e}},2);const l=e=>e.every(e=>["number","string","symbol"].includes(typeof e)),$=(e,r)=>{let n=null;if(l(e)){n={};for(const r of e)n[r]=r}return r=>i(r,r=>"string"==typeof r&&null!==n?!!n[r]:e.some(e=>t(e,r)))},y=(e,r)=>{const n=$(e,void 0);return e=>void 0===e||!n(e)},p=(e,r)=>r=>!!Array.isArray(r)&&e.every(e=>r.some(r=>t(e,r))),m=(e,r)=>r=>o(r,r=>u(r,e)<0),f=(e,r)=>r=>o(r,r=>u(r,e)<=0),g=(e,r)=>r=>o(r,r=>u(r,e)>0),v=(e,r)=>r=>o(r,r=>u(r,e)>=0),d=(e,r)=>r=>!i(r,r=>t(r,e)),A=(e,r)=>r=>e===(void 0!==r),b=(e,r)=>{let[n,t]=e;return e=>o(e,e=>Number(e)%n===t)},x=(e,r)=>r=>Array.isArray(r)&&e===r.length,k=(e,r)=>r=>void 0!==r&&o(r,r=>a(r)===e),h=(e,r)=>{let n;if(void 0!==r){const t=e instanceof RegExp?e.source:e;n=new RegExp(t,r)}else e instanceof RegExp||(n=new RegExp(e));return e=>void 0!==e&&o(e,e=>n.test(String(e)))},O=(e,r)=>{const n=K(e);return e=>!!Array.isArray(e)&&e.some(e=>n(e))},S=(e,r)=>{const n=J(e);return e=>!n(e)},w=(e,r)=>e=>!0,E=w,R=w,j=w,F={$in:$,$nin:y,$all:p,$lt:m,$lte:f,$gt:g,$gte:v,$ne:d,$exists:A,$mod:b,$size:x,$type:k,$regex:h,$elemMatch:O,$not:S,$options:E,$near:R,$geoIntersects:j},N=e=>{const r=e.map(K);return e=>r.every(r=>r(e))},B=e=>{const r=e.map(K);return e=>r.some(r=>r(e))},q=e=>{const r=e.map(K);return e=>r.every(r=>!r(e))},z=e=>{const r=e instanceof Function?e:Function("return ".concat(e));return e=>!!r.call(e)},D={$and:N,$or:B,$nor:q,$where:z},I=e=>e in F,L=e=>e in D,M=e=>Object.keys(e).every(e=>"$"===e.slice(0,1)),T=()=>e=>o(e,e=>null==e),V=e=>r=>o(r,r=>r===e),C=e=>r=>void 0!==r&&o(r,r=>e.test(String(r))),G=e=>r=>!!Array.isArray(r)&&i(r,r=>t(e,r)),H=e=>{const r=[];for(const n of Object.keys(e)){if(!I(n))continue;const t=e[n],o=F[n];r.push(o(t,e.$options))}return e=>r.every(r=>r(e))},J=e=>null==e?T():s(e)?e instanceof RegExp?C(e):Array.isArray(e)?G(e):M(e)?H(e):r=>o(r,r=>t(e,r)):V(e),K=e=>{const r=Object.entries(e).map(e=>{let[r,n]=e;if(void 0===n)return()=>!0;if(L(r))switch(r){case"$and":return N(n);case"$or":return B(n);case"$nor":return q(n);case"$where":return z(n)}const t=c(r),o=J(n);return e=>{const r=t(e);return r.some(o)}});return e=>r.every(r=>r(e))}}

