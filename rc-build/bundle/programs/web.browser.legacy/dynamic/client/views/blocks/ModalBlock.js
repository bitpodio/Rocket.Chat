function module(e,t,n){var i,r,o,a,u,c,l,d,f,s,v,m,p,b,k,I,g,x,y,E,h,C,w,S,M;n.link("@babel/runtime/helpers/objectSpread2",{default:function(e){i=e}},0),n.link("@babel/runtime/helpers/objectWithoutProperties",{default:function(e){r=e}},1),n.link("@babel/runtime/helpers/slicedToArray",{default:function(e){o=e}},2),n.export({ModalBlock:function(){return U}}),n.link("@rocket.chat/apps-engine/definition/uikit/UIKitIncomingInteractionContainer",{UIKitIncomingInteractionContainerType:function(e){a=e}},0),n.link("@rocket.chat/fuselage",{Modal:function(e){u=e},AnimatedVisibility:function(e){c=e},ButtonGroup:function(e){l=e},Button:function(e){d=e},Box:function(e){f=e}},1),n.link("@rocket.chat/fuselage-hooks",{useMutableCallback:function(e){s=e},useUniqueId:function(e){v=e}},2),n.link("@rocket.chat/fuselage-ui-kit",{kitContext:function(e){m=e},UiKitComponent:function(e){p=e},UiKitModal:function(e){b=e},modalParser:function(e){k=e}},3),n.link("react",{default:function(e){I=e},useCallback:function(e){g=e},useEffect:function(e){x=e},useMemo:function(e){y=e},useReducer:function(e){E=e},useRef:function(e){h=e},useState:function(e){C=e}},4),n.link("../../lib/renderMessageBody",{renderMessageBody:function(e){w=e}},5),n.link("../../../app/utils/lib/getURL",{getURL:function(e){S=e}},6),n.link("../../../app/ui-message/client/ActionManager",{"*":function(e){M=e}},7),k.plainText=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.text;return t},k.mrkdwn=function(e){var t=e.text;return(I.createElement("span",{dangerouslySetInnerHTML:{__html:w({msg:t})}}))};var P='\n\ta[href]:not([tabindex="-1"]),\n\tarea[href]:not([tabindex="-1"]),\n\tinput:not([disabled]):not([tabindex="-1"]),\n\tselect:not([disabled]):not([tabindex="-1"]),\n\ttextarea:not([disabled]):not([tabindex="-1"]),\n\tbutton:not([disabled]):not([tabindex="-1"]),\n\tiframe,\n\tobject,\n\tembed,\n\t[tabindex]:not([tabindex="-1"]),\n\t[contenteditable]',A='\n\ta[href]:not([tabindex="-1"]):invalid,\n\tarea[href]:not([tabindex="-1"]):invalid,\n\tinput:not([disabled]):not([tabindex="-1"]):invalid,\n\tselect:not([disabled]):not([tabindex="-1"]):invalid,\n\ttextarea:not([disabled]):not([tabindex="-1"]):invalid,\n\tbutton:not([disabled]):not([tabindex="-1"]):invalid,\n\tiframe:invalid,\n\tobject:invalid,\n\tembed:invalid,\n\t[tabindex]:not([tabindex="-1"]):invalid,\n\t[contenteditable]:invalid';function U(e){var t=e.view,n=e.errors,i=e.appId,r=e.onSubmit,a=e.onClose,s=e.onCancel,m="modal_id_"+v(),E=h();x((function(){if(E.current)if(n&&Object.keys(n).length){var e=E.current.querySelector(A);e&&e.focus()}else{var t=E.current.querySelector(P);t&&t.focus()}}),[n]);var C=y((function(){return document.activeElement}),[]);x((function(){return function(){return C&&C.focus()}}),[C]);var w=g((function(e){if(13===e.keyCode)return r(e);if(27===e.keyCode)return e.stopPropagation(),e.preventDefault(),a(),!1;if(9===e.keyCode){var t=Array.from(E.current.querySelectorAll(P)),n,i=o(t,1)[0],u=t.pop();if(!E.current.contains(document.activeElement))return i.focus();if(e.shiftKey)return void(i&&i!==document.activeElement||(u.focus(),e.stopPropagation(),e.preventDefault()));u&&u!==document.activeElement||(i.focus(),e.stopPropagation(),e.preventDefault())}}),[a,r]);return x((function(){var e=document.querySelector(".rc-modal-wrapper"),t=e.querySelector(".rcx-modal__content"),n=function(t){if(t.target===e)return t.preventDefault(),t.stopPropagation(),a(),!1},i=function(e){if(t.contains(e.target))return w(e)};return document.addEventListener("keydown",i),e.addEventListener("click",n),function(){document.removeEventListener("keydown",i),e.removeEventListener("click",n)}}),[w,a]),I.createElement(c,{visibility:c.UNHIDING},I.createElement(u,{open:!0,id:m,ref:E},I.createElement(u.Header,null,t.showIcon?I.createElement(u.Thumb,{url:S("/api/apps/"+i+"/icon")}):null,I.createElement(u.Title,null,k.text(t.title)),I.createElement(u.Close,{tabIndex:-1,onClick:a})),I.createElement(u.Content,null,I.createElement(f,{is:"form",method:"post",action:"#",onSubmit:r},I.createElement(p,{render:b,blocks:t.blocks}))),I.createElement(u.Footer,null,I.createElement(l,{align:"end"},t.close&&I.createElement(d,{onClick:s},k.text(t.close.text)),t.submit&&I.createElement(d,{primary:!0,onClick:r},k.text(t.submit.text))))))}var j=function(e){var t=C(e),n=o(t,2),a=n[0],u=n[1],c=a.viewId;return x((function(){var e=function(e){var t=e.type,n=r(e,["type"]);if("errors"!==t)u(n);else{var o=n.errors;u((function(e){return i(i({},e),{},{errors:o})}))}};return M.on(c,e),function(){M.off(c,e)}}),[c]),a},B=function(e){var t=s((function(e,t){var n,r=t.actionId,o=t.payload;return i(i({},e),{},((n={})[r]=o,n))})),n=s((function(){var t=function(e){var n=e.element,i=e.elements,r=void 0===i?[]:i;return!(!n||!n.initialValue)||(!(!r.length||!r.map((function(e){return{element:e}})).filter(t).length)||void 0)},n=function(e){var i=e.element,r=e.blockId,o=e.elements,a=void 0===o?[]:o;return a.length?a.map((function(e){return{element:e,blockId:r}})).filter(t).map(n):[i.actionId,{value:i.initialValue,blockId:r}]};return e.blocks.filter(t).map(n).reduce((function(e,t){var n;if(Array.isArray(t[0]))return i(i({},e),Object.fromEntries(t));var r=o(t,2),a=r[0],u=r[1];return i(i({},e),{},((n={})[a]=u,n))}),{})}));return E(t,null,n)};function D(e){var t=j(e),n=t.appId,r=t.viewId,u=t.mid,c=t.errors,l=t.view,d=B(l),f=o(d,2),v=f[0],p=f[1],b=function(e){return Object.entries(e).reduce((function(e,t){var n=o(t,2),i=n[0],r=n[1],a=r.blockId,u=r.value;return e[a]=e[a]||{},e[a][i]=u,e}),{})},k=function(e){e&&((e.nativeEvent||e).stopImmediatePropagation(),e.stopPropagation(),e.preventDefault())},g=i(i({action:function(e){var t=e.actionId,n=e.appId,i=e.value,o=e.blockId,c=e.mid,l=void 0===c?u:c;return M.triggerBlockAction({container:{type:a.VIEW,id:r},actionId:t,appId:n,value:i,blockId:o,mid:l})},state:function(e){var t=e.actionId,n=e.value,i=e.blockId,r;p({actionId:t,payload:{blockId:void 0===i?"default":i,value:n}})}},t),{},{values:v}),x=s((function(e){k(e),M.triggerSubmitView({viewId:r,appId:n,payload:{view:i(i({},l),{},{id:r,state:b(v)})}})})),y=s((function(e){return k(e),M.triggerCancel({appId:n,viewId:r,view:i(i({},l),{},{id:r,state:b(v)})})})),E=s((function(e){return k(e),M.triggerCancel({appId:n,viewId:r,view:i(i({},l),{},{id:r,state:b(v)}),isCleared:!0})}));return I.createElement(m.Provider,{value:g},I.createElement(U,{view:l,errors:c,appId:n,onSubmit:x,onCancel:y,onClose:E}))}n.exportDefault(D)}

