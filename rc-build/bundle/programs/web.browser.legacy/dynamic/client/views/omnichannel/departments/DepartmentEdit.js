function module(e,n,t){var a,l,o,r,i,s,u,c,m,d,f,h,p,g,E,_,b,C,x,v,w,k,S,T,R,M,D,y,I,A,O,F,N,L,q,G,B,H,P,Q,U,W;function j(e){var n=e.id,t=e.reload,a=e.title,l=D(),o=P("livechat/department/"+n),r=o.value,s=o.phase,u=o.error;return[s].includes(Q.LOADING)?i.createElement(I,null):u?i.createElement(g,{mbs:"x16"},l("User_not_found")):i.createElement(z,{id:n,data:r,reload:t,title:a})}t.link("@babel/runtime/helpers/objectSpread2",{default:function(e){a=e}},0),t.link("@babel/runtime/regenerator",{default:function(e){l=e}},1),t.link("@babel/runtime/helpers/toConsumableArray",{default:function(e){o=e}},2),t.link("@babel/runtime/helpers/slicedToArray",{default:function(e){r=e}},3),t.export({default:function(){return j},EditDepartment:function(){return z}}),t.link("react",{default:function(e){i=e},useMemo:function(e){s=e},useState:function(e){u=e},useRef:function(e){c=e}},0),t.link("@rocket.chat/fuselage",{FieldGroup:function(e){m=e},Field:function(e){d=e},TextInput:function(e){f=e},Chip:function(e){h=e},SelectFiltered:function(e){p=e},Box:function(e){g=e},Icon:function(e){E=e},Divider:function(e){_=e},ToggleSwitch:function(e){b=e},TextAreaInput:function(e){C=e},ButtonGroup:function(e){x=e},Button:function(e){v=e}},1),t.link("@rocket.chat/fuselage-hooks",{useMutableCallback:function(e){w=e},useUniqueId:function(e){k=e}},2),t.link("use-subscription",{useSubscription:function(e){S=e}},3),t.link("../../../contexts/ServerContext",{useMethod:function(e){T=e}},4),t.link("../../../hooks/useEndpointAction",{useEndpointAction:function(e){R=e}},5),t.link("../../../contexts/ToastMessagesContext",{useToastMessageDispatch:function(e){M=e}},6),t.link("../../../contexts/TranslationContext",{useTranslation:function(e){D=e}},7),t.link("../../../contexts/SettingsContext",{useSetting:function(e){y=e}},8),t.link("../../../components/Skeleton",{FormSkeleton:function(e){I=e}},9),t.link("../../../hooks/useForm",{useForm:function(e){A=e}},10),t.link("../../../contexts/RouterContext",{useRoute:function(e){O=e},useRouteParameter:function(e){F=e},useCurrentRoute:function(e){N=e}},11),t.link("../../../components/Page",{default:function(e){L=e}},12),t.link("./DepartmentsAgentsTable",{default:function(e){q=e}},13),t.link("../additionalForms",{formsSubscription:function(e){G=e}},14),t.link("../../../hooks/useComponentDidUpdate",{useComponentDidUpdate:function(e){B=e}},15),t.link("../../../../app/utils",{isEmail:function(e){H=e}},16),t.link("../../../hooks/useEndpointData",{useEndpointData:function(e){P=e}},17),t.link("../../../hooks/useAsyncState",{AsyncStatePhase:function(e){Q=e}},18),t.link("../../../../ee/client/hooks/useHasLicense",{useHasLicense:function(e){U=e}},19),t.link("../../../../ee/client/omnichannel/cannedResponses",{default:function(e){W=e}},20);var V=function(e){var n=e.name;return s((function(){return{selector:JSON.stringify({name:n})}}),[n])};function z(e){var n=e.data,t=e.id,I=e.title,Q=e.reload,j=D(),z=O("omnichannel-departments"),J=S(G),K=c(n&&n.agents||[]),X=O("omnichannel-departments"),Y=N(),Z,$=r(Y,2)[1],ee=J.useEeNumberInput,ne=void 0===ee?function(){}:ee,te=J.useEeTextInput,ae=void 0===te?function(){}:te,le=J.useEeTextAreaInput,oe=void 0===le?function(){}:le,re=J.useDepartmentForwarding,ie=void 0===re?function(){}:re,se=J.useDepartmentBusinessHours,ue=void 0===se?function(){}:se,ce=ne(),me=ne(),de=oe(),fe=ae(),he=ie(),pe=ue(),ge=u([]),Ee=r(ge,2),_e=Ee[0],be=Ee[1],Ce,xe=(n||{department:{}}).department,ve=u(xe&&xe.chatClosingTags||[]),we=r(ve,2),ke=we[0],Se=we[1],Te=u(),Re=r(Te,2),Me=Re[0],De=Re[1],ye=A({name:xe&&xe.name||"",email:xe&&xe.email||"",description:xe&&xe.description||"",enabled:!(!xe||!xe.enabled),maxNumberSimultaneousChat:xe&&xe.maxNumberSimultaneousChat||void 0,showOnRegistration:!(!xe||!xe.showOnRegistration),showOnOfflineForm:!(!xe||!xe.showOnOfflineForm),abandonedRoomsCloseCustomMessage:xe&&xe.abandonedRoomsCloseCustomMessage||"",requestTagBeforeClosingChat:xe&&xe.requestTagBeforeClosingChat||!1,offlineMessageChannelName:xe&&xe.offlineMessageChannelName||"",visitorInactivityTimeoutInSeconds:xe&&xe.visitorInactivityTimeoutInSeconds||void 0,waitingQueueMessage:xe&&xe.waitingQueueMessage||"",departmentsAllowedToForward:xe&&xe.departmentsAllowedToForward||[]}),Ie=ye.values,Ae=ye.handlers,Oe=ye.hasUnsavedChanges,Fe=Ae.handleName,Ne=Ae.handleEmail,Le=Ae.handleDescription,qe=Ae.handleEnabled,Ge=Ae.handleMaxNumberSimultaneousChat,Be=Ae.handleShowOnRegistration,He=Ae.handleShowOnOfflineForm,Pe=Ae.handleAbandonedRoomsCloseCustomMessage,Qe=Ae.handleRequestTagBeforeClosingChat,Ue=Ae.handleOfflineMessageChannelName,We=Ae.handleVisitorInactivityTimeoutInSeconds,je=Ae.handleWaitingQueueMessage,Ve=Ae.handleDepartmentsAllowedToForward,ze=Ie.name,Je=Ie.email,Ke=Ie.description,Xe=Ie.enabled,Ye=Ie.maxNumberSimultaneousChat,Ze=Ie.showOnRegistration,$e=Ie.showOnOfflineForm,en=Ie.abandonedRoomsCloseCustomMessage,nn=Ie.requestTagBeforeClosingChat,tn=Ie.offlineMessageChannelName,an=Ie.visitorInactivityTimeoutInSeconds,ln=Ie.waitingQueueMessage,on=Ie.departmentsAllowedToForward,rn=function(e){return function(){Se((function(n){return n.filter((function(n){return n!==e}))}))}},sn=w((function(){ke.includes(Me)||(Se([].concat(o(ke),[Me])),De(""))})),un=w((function(e){De(e.target.value)})),cn=V({offlineMessageChannelName:tn}),mn,dn=P("rooms.autocomplete.channelAndPrivate",cn).value,fn=void 0===dn?{}:dn,hn=s((function(){return fn&&fn.items?fn.items.map((function(e){var n=e.name;return[n,n]})):[]}),[fn]),pn=T("livechat:saveDepartment"),gn=R("POST","livechat/department/"+t+"/agents"),En=M(),_n=u(),bn=r(_n,2),Cn=bn[0],xn=bn[1],vn=u(),wn=r(vn,2),kn=wn[0],Sn=wn[1],Tn=u(),Rn=r(Tn,2),Mn=Rn[0],Dn=Rn[1];B((function(){xn(ze?"":j("The_field_is_required","name"))}),[j,ze]),B((function(){Sn(Je?"":j("The_field_is_required","email"))}),[j,Je]),B((function(){Sn(H(Je)?"":j("Validate_email_address"))}),[j,Je]),B((function(){Dn(!nn||ke&&0!==ke.length?"":j("The_field_is_required","name"))}),[nn,j,ke]);var yn=w(function(){function e(e){var n,a,o;return l.async(function(){function r(r){for(;;)switch(r.prev=r.next){case 0:if(e.preventDefault(),n=!1,ze||(xn(j("The_field_is_required","name")),n=!0),Je||(Sn(j("The_field_is_required","email")),n=!0),H(Je)||(Sn(j("Validate_email_address")),n=!0),!nn||ke&&0!==ke.length||(Dn(j("The_field_is_required","tags")),n=!0),!n){r.next=8;break}return r.abrupt("return");case 8:if(a={enabled:Xe,name:ze,description:Ke,showOnRegistration:Ze,showOnOfflineForm:$e,requestTagBeforeClosingChat:nn,email:Je,chatClosingTags:ke,offlineMessageChannelName:tn,maxNumberSimultaneousChat:Ye,visitorInactivityTimeoutInSeconds:an,abandonedRoomsCloseCustomMessage:en,waitingQueueMessage:ln,departmentsAllowedToForward:on&&on.join()},o={upsert:_e.filter((function(e){return!K.current.some((function(n){return n._id===e._id&&e.count===n.count&&e.order===n.order}))})),remove:K.current.filter((function(e){return!_e.some((function(n){return e._id===n._id}))}))},r.prev=10,!t){r.next=18;break}return r.next=14,l.awrap(pn(t,a,[]));case 14:return r.next=16,l.awrap(gn(o));case 16:r.next=20;break;case 18:return r.next=20,l.awrap(pn(t,a,_e));case 20:En({type:"success",message:j("Saved")}),Q(),z.push({}),r.next=28;break;case 25:r.prev=25,r.t0=r.catch(10),En({type:"error",message:r.t0});case 28:case"end":return r.stop()}}return r}(),null,null,[[10,25]],Promise)}return e}()),In=w((function(){X.push({})})),An=!ze||!Je||!H(Je)||!Oe||nn&&(!ke||0===ke.length),On=k(),Fn=F("tab"),Nn=U("canned-responses"),Ln=y("Canned_Responses_Enable"),qn=Nn&&Ln&&"canned-responses"===Fn,Gn=w((function(){X.push(a(a({},$),{},{tab:"canned-responses"}))})),Bn=w((function(){X.push(a(a({},$),{},{tab:""}))})),Hn=s((function(){return n.agents.length===_e.length}),[n.agents,_e]);return i.createElement(L,{flexDirection:"row"},i.createElement(L,null,i.createElement(L.Header,{title:I},i.createElement(x,null,t&&Nn&&Ln&&i.createElement(v,{onClick:Gn,title:j("Canned Responses")},i.createElement(E,{name:"baloon-exclamation",size:"x16"})),i.createElement(v,{onClick:In},i.createElement(E,{name:"back"})," ",j("Back")),i.createElement(v,{type:"submit",form:On,primary:!0,disabled:An&&Hn},j("Save")))),i.createElement(L.ScrollableContentWithShadow,null,i.createElement(m,{w:"full",alignSelf:"center",maxWidth:"x600",id:On,is:"form",autoComplete:"off",onSubmit:yn},i.createElement(d,null,i.createElement(g,{display:"flex",flexDirection:"row"},i.createElement(d.Label,null,j("Enabled")),i.createElement(d.Row,null,i.createElement(b,{flexGrow:1,checked:Xe,onChange:qe})))),i.createElement(d,null,i.createElement(d.Label,null,j("Name"),"*"),i.createElement(d.Row,null,i.createElement(f,{flexGrow:1,error:Cn,value:ze,onChange:Fe,placeholder:j("Name")}))),i.createElement(d,null,i.createElement(d.Label,null,j("Description")),i.createElement(d.Row,null,i.createElement(C,{flexGrow:1,value:Ke,onChange:Le,placeholder:j("Description")}))),i.createElement(d,null,i.createElement(g,{display:"flex",flexDirection:"row"},i.createElement(d.Label,null,j("Show_on_registration_page")),i.createElement(d.Row,null,i.createElement(b,{flexGrow:1,checked:Ze,onChange:Be})))),i.createElement(d,null,i.createElement(d.Label,null,j("Email"),"*"),i.createElement(d.Row,null,i.createElement(f,{flexGrow:1,error:kn,value:Je,addon:i.createElement(E,{name:"mail",size:"x20"}),onChange:Ne,placeholder:j("Email")}))),i.createElement(d,null,i.createElement(g,{display:"flex",flexDirection:"row"},i.createElement(d.Label,null,j("Show_on_offline_page")),i.createElement(d.Row,null,i.createElement(b,{flexGrow:1,checked:$e,onChange:He})))),i.createElement(d,null,i.createElement(d.Label,null,j("Livechat_DepartmentOfflineMessageToChannel")),i.createElement(d.Row,null,i.createElement(p,{flexGrow:1,options:hn,value:tn,onChange:Ue,placeholder:j("Channel_name")}))),ce&&i.createElement(d,null,i.createElement(ce,{value:Ye,handler:Ge,label:"Max_number_of_chats_per_agent",placeholder:"Max_number_of_chats_per_agent_description"})),me&&i.createElement(d,null,i.createElement(me,{value:an,handler:We,label:"How_long_to_wait_to_consider_visitor_abandonment_in_seconds",placeholder:"Number_in_seconds"})),fe&&i.createElement(d,null,i.createElement(fe,{value:en,handler:Pe,label:"Livechat_abandoned_rooms_closed_custom_message",placeholder:"Enter_a_custom_message"})),de&&i.createElement(d,null,i.createElement(de,{value:ln,handler:je,label:"Waiting_queue_message"})),he&&i.createElement(d,null,i.createElement(he,{departmentId:t,value:on,handler:Ve,label:"List_of_departments_for_forward",placeholder:"Enter_a_department_name"})),i.createElement(d,null,i.createElement(g,{display:"flex",flexDirection:"row"},i.createElement(d.Label,null,j("Request_tag_before_closing_chat")),i.createElement(d.Row,null,i.createElement(b,{flexGrow:1,checked:nn,onChange:Qe})))),nn&&i.createElement(d,null,i.createElement(d.Label,{alignSelf:"stretch"},j("Conversation_closing_tags"),"*"),i.createElement(d.Row,null,i.createElement(f,{error:Mn,value:Me,onChange:un,placeholder:j("Enter_a_tag")}),i.createElement(v,{mis:"x8",title:j("add"),onClick:sn},j("Add"))),i.createElement(d.Hint,null,j("Conversation_closing_tags_description")),ke&&ke.length>0&&i.createElement(d.Row,{justifyContent:"flex-start"},ke.map((function(e,n){return i.createElement(h,{key:n,onClick:rn(e),mie:"x8"},e)})))),pe&&i.createElement(d,null,i.createElement(pe,{bhId:xe&&xe.businessHourId})),i.createElement(_,{mb:"x16"}),i.createElement(d,null,i.createElement(d.Label,{mb:"x4"},j("Agents"),":"),i.createElement(g,{display:"flex",flexDirection:"column",height:"50vh"},i.createElement(q,{agents:n&&n.agents,setAgentListFinal:be})))))),qn&&i.createElement(W,{departmentId:t,onClose:Bn}))}}

