function module(e,n,t){var r,i,a,l,o,u,s,c,m,f,d,p,v,h,b,E,x,k,_,g,w,y,M;function C(e){var n=e.unitId,t=e.reload,r=e.allUnits,i=o((function(){return{unitId:n}}),[n]),a=w("livechat/units.getOne",i),u=a.value,s=a.phase,c=a.error,m=w("livechat/department"),f=m.value,p=m.phase,v=m.error,h=w("livechat/monitors.list"),b=h.value,E=h.phase,k=h.error,_=w("livechat/unitMonitors.list",i),g=_.value,C=_.phase,D=_.error,I=x();if([s,p,E,C].includes(y.LOADING))return l.createElement(M,null);if(c||v||k||D)return l.createElement(d,{m:"x16",type:"danger"},I("Not_Available"));var N={departments:f.departments.filter((function(e){return!(r&&r.units&&e.ancestors&&e.ancestors[0]!==n&&r.units.find((function(n){return n._id===e.ancestors[0]})))}))};return(l.createElement(S,{unitId:n,data:u,availableDepartments:N,availableMonitors:b,unitMonitors:g,reload:t}))}function D(e){var n=e.reload,t=e.allUnits,r=x(),i=w("livechat/department"),a=i.value,o=i.phase,u=i.error,s=w("livechat/monitors.list"),c=s.value,f=s.phase,d=s.error;if([o,f].includes(y.LOADING))return l.createElement(M,null);if(u||d)return l.createElement(m,{mbs:"x16"},r("Not_found"));var p={departments:a.departments.filter((function(e){return!(t&&t.units&&e.ancestors&&t.units.find((function(n){return n._id===e.ancestors[0]})))}))};return(l.createElement(S,{reload:n,isNew:!0,availableDepartments:p,availableMonitors:c}))}function S(e){var n=e.data,t=e.unitId,d=e.isNew,w=e.availableDepartments,y=e.availableMonitors,M=e.unitMonitors,C=e.reload,D=a(e,["data","unitId","isNew","availableDepartments","availableMonitors","unitMonitors","reload"]),S=x(),I=g("omnichannel-units"),N=n||{},T=o((function(){return w&&w.departments?w.departments.map((function(e){var n=e._id,t;return[n,e.name||n]})):[]}),[w]),G=o((function(){return y&&y.monitors?y.monitors.map((function(e){var n=e._id,t;return[n,e.name||n]})):[]}),[y]),R=o((function(){return M&&M.monitors?M.monitors.map((function(e){var n;return e.monitorId})):[]}),[M]),U=[["public",S("Public")],["private",S("Private")]],L=o((function(){return w&&w.departments&&t?w.departments.map((function(e){var n;return e.parentId===t&&(n=e._id),n})).filter((function(e){return!!e})):[]}),[w,t]),q=_({name:N.name,visibility:N.visibility,departments:L,monitors:R}),A=q.values,P=q.handlers,F=q.hasUnsavedChanges,W=P.handleName,B=P.handleVisibility,O=P.handleDepartments,V=P.handleMonitors,j=A.name,z=A.visibility,H=A.departments,J=A.monitors,K=o((function(){return j&&0!==j.length?void 0:S("The_field_is_required",S("name"))}),[j,S]),Q=o((function(){return z&&0!==z.length?void 0:S("The_field_is_required",S("description"))}),[z,S]),X=o((function(){return H&&0!==H.length?void 0:S("The_field_is_required",S("departments"))}),[H,S]),Y=o((function(){return J&&0!==J.length?void 0:S("The_field_is_required",S("monitors"))}),[J,S]),Z=b("livechat:saveUnit"),$=E(),ee=h((function(){C()})),ne=o((function(){return!(K||Q||X||Y)}),[K,Q,X,Y]),te=h(function(){function e(){var e,n,r;return i.async(function(){function a(a){for(;;)switch(a.prev=a.next){case 0:if(e={name:j,visibility:z},n=H.map((function(e){return{departmentId:e}})),r=J.map((function(e){var n=G.find((function(n){return n[0]===e}));return{monitorId:n[0],username:n[1]}})),ne){a.next=5;break}return a.abrupt("return",$({type:"error",message:S("The_field_is_required")}));case 5:return a.prev=5,a.next=8,i.awrap(Z(t,e,r,n));case 8:$({type:"success",message:S("Saved")}),C(),I.push({}),a.next=16;break;case 13:a.prev=13,a.t0=a.catch(5),$({type:"error",message:a.t0});case 16:case"end":return a.stop()}}return a}(),null,null,[[5,13]],Promise)}return e}());return l.createElement(k.ScrollableContent,r({is:"form"},D),l.createElement(u,null,l.createElement(u.Label,null,S("Name"),"*"),l.createElement(u.Row,null,l.createElement(s,{placeholder:S("Name"),flexGrow:1,value:j,onChange:W,error:F&&K}))),l.createElement(u,null,l.createElement(u.Label,null,S("Visibility"),"*"),l.createElement(u.Row,null,l.createElement(p,{options:U,value:z,error:F&&Q,placeholder:S("Select_an_option"),onChange:B,flexGrow:1}))),l.createElement(u,null,l.createElement(u.Label,null,S("Departments"),"*"),l.createElement(u.Row,null,l.createElement(f,{options:T,value:H,error:F&&X,maxWidth:"100%",placeholder:S("Select_an_option"),onChange:O,flexGrow:1}))),l.createElement(u,null,l.createElement(u.Label,null,S("Monitors"),"*"),l.createElement(u.Row,null,l.createElement(f,{options:G,value:J,error:F&&Y,maxWidth:"100%",placeholder:S("Select_an_option"),onChange:V,flexGrow:1}))),l.createElement(u.Row,null,l.createElement(m,{display:"flex",flexDirection:"row",justifyContent:"space-between",w:"full"},l.createElement(v,{inlineEnd:"x4"},!d&&l.createElement(c,{flexGrow:1,type:"reset",disabled:!F,onClick:ee},S("Reset")),l.createElement(c,{primary:!0,mie:"none",flexGrow:1,disabled:!F||!ne,onClick:te},S("Save"))))))}t.link("@babel/runtime/helpers/extends",{default:function(e){r=e}},0),t.link("@babel/runtime/regenerator",{default:function(e){i=e}},1),t.link("@babel/runtime/helpers/objectWithoutProperties",{default:function(e){a=e}},2),t.export({UnitEditWithData:function(){return C},UnitNew:function(){return D},UnitEdit:function(){return S}}),t.link("react",{default:function(e){l=e},useMemo:function(e){o=e}},0),t.link("@rocket.chat/fuselage",{Field:function(e){u=e},TextInput:function(e){s=e},Button:function(e){c=e},Box:function(e){m=e},MultiSelect:function(e){f=e},Callout:function(e){d=e},Select:function(e){p=e},Margins:function(e){v=e}},1),t.link("@rocket.chat/fuselage-hooks",{useMutableCallback:function(e){h=e}},2),t.link("../../../../client/contexts/ServerContext",{useMethod:function(e){b=e}},3),t.link("../../../../client/contexts/ToastMessagesContext",{useToastMessageDispatch:function(e){E=e}},4),t.link("../../../../client/contexts/TranslationContext",{useTranslation:function(e){x=e}},5),t.link("../../../../client/components/VerticalBar",{default:function(e){k=e}},6),t.link("../../../../client/hooks/useForm",{useForm:function(e){_=e}},7),t.link("../../../../client/contexts/RouterContext",{useRoute:function(e){g=e}},8),t.link("../../../../client/hooks/useEndpointData",{useEndpointData:function(e){w=e}},9),t.link("../../../../client/hooks/useAsyncState",{AsyncStatePhase:function(e){y=e}},10),t.link("../../../../client/components/Skeleton",{FormSkeleton:function(e){M=e}},11)}

